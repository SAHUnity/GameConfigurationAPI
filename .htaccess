<IfModule mod_rewrite.c>
    RewriteEngine On

    # Block sensitive directories and files
    RewriteRule ^(src|var|tools|vendor|(\.git))(/|$) - [F]
    RewriteRule \.(env|json|lock|md|ps1|yml|xml|log)$ - [F]
    RewriteRule ^(autoload\.php|composer\.json|composer\.lock)$ - [F]

    # API Routing
    RewriteRule ^api/v1/?$ api/index.php [L,QSA]

    # CORS Headers
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
    Header set Access-Control-Allow-Headers "Content-Type, X-API-KEY, Authorization"

    # Deep protection for .env
    <Files .env>
        Order allow,deny
        Deny from all
    </Files>
</IfModule>
